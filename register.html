<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>注册</title>
<link rel="stylesheet" href="css/style.css">      
</head>
<body>
	<dl class="regist_list">
		<dt>已有账号<a href="login.html"><span>登录</span></a></dt>
		<dd class="user"><input type="text" placeholder="请输入用户名" class="username"></dd>
		<dd class="mail"><input type="mail" placeholder="请输入邮箱" class="usermail"></dd>
		<dd class="user"><input type="number" placeholder="输入手机号" class="telnumber"></dd>
		<dd class="rand"><input type="text" placeholder="输入验证码" class="randnuber"><img src="http://passport.zongheng.com/validateImage" tsrc="http://h5.wingoalclub.com/inf/authImage" alt="验证码" class="randimg"></dd>
		<dd class="key"><input type="password" placeholder="输入密码（数字，字母及下划线，6-12个字符)" minlength="6" maxlength="12" class="password"></dd>
		<dd class="key"><input type="password" placeholder="再次输入密码" minlength="6" maxlength="12" class="re-password"></dd>
		<div class="end_dd">
			<!-- <a href="product_intr.html">
			<div class="pad_contr"><input type="checkbox" checked="checked" id="law_btn"> 我已经阅读并同意《用户使用条款和隐私协议》</div>
			</a> -->
			<div class="reg_btn submit-reg">注册</div>
		</div>
	</dl>
<script src="js/jquery.js" type="text/javascript"></script>
<script type="text/javascript">
$(function (){
	var form=$(".regist_list");
	var telphoneReg = /(1[3-9]\d{9}$)/;
	var mailReg=/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
	function beforeSubmit(){
		if($.trim(form.find(".username").val())==""){
			alert("用户名不能为空！");
			return false;
		}
		else if($.trim(form.find(".usermail").val())=="" || !mailReg.test($.trim(form.find(".usermail").val()))){
			alert("邮箱格式不对！");
			return false;
		}else if($.trim(form.find(".telnumber").val())=="" || !telphoneReg.test($.trim(form.find(".telnumber").val()))){
			alert("手机号格式不对！");
			return false;
		}else if($.trim(form.find(".randnuber").val())==""){
			alert("验证码不能为空！");
			return false;
		}else if($.trim(form.find(".password").val())==""){
			alert("密码不能为空！");
			return false;
		}else if($.trim(form.find(".re-password").val())=="" || $.trim(form.find(".password").val())!=$.trim(form.find(".re-password").val())){
			alert("两次密码输入不一致！");
			return false;
		}
		return true;
	}
	$(".randimg").click(function (){
		var tt=new Date().getTime();
		var t=$(this);
		t.attr("src",t.attr(src)+t);
	});
	$(".submit-reg").click(function (){
		if(beforeSubmit()){
			var username=$.trim(form.find(".username").val());
			var mail=$.trim(form.find(".usermail").val());
			var passwd=$.trim(form.find(".password").val());
			var phone=$.trim(form.find(".telnumber").val());
			var verifyCode=$.trim(form.find(".randnuber").val());
			$.ajax({
				type:"get",
				url:"http://h5.wingoalclub.com/inf/encryptPasswd",
				data:{password:passwd},
				dataType:"json",
				error:function (){alert("注册出错啦！请您重试");console.error("密码加密出错")},
				success:function (data){
					if(data==null || data==""){
						alert("注册出错啦！请您重试");
					}else{
						if(data && data.encryptPasswd){
							passwd=data.encryptPasswd;
							var confimPasswd=data.encryptPasswd;
							$.ajax({
								type:"get",
								url:"http://h5.wingoalclub.com/inf/registerUser",
								data:{username:username,mail:mail,passwd:passwd,confimPasswd:confimPasswd,phone:phone,verifyCode:verifyCode,t:new Date().getTime()},
								dataType:"json",
								error:function (){alert("注册出错啦！请您重试");},
								success:function (data){
									if(data && data.status == 200){
										alert("恭喜您注册成功！");
										location.href="http://"+location.host;
									}else{
										alert("注册出错啦！请您重试");
									}
								}
							});
						}

					}
				}
			});

			
		}
	});
});

</script>
</body>
</html>
