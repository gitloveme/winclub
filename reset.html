<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>忘记密码</title>
	<link rel="stylesheet" href="css/style.css">        
</head>
<body>
	<input id="smsCode" type="hidden" value=""/>
	<dl class="regist_list regist_list2 add_top">			
		<dd><input type="number" placeholder="输入手机号" id="tel_num"><span class="buy-btn" onClick="telCheck()">获取验证码</span></dd>
		<dd><input type="number" placeholder="输入验证码" id="yz_code"></dd>			
		<dd><input type="password" placeholder="输入新密码（数字，字母及下划线，6-12个字符）"id="passwd"></dd>			
		<div class="end_dd">				
			<div class="reg_btn reg_btn2">确认提交</div>
		</div>
	</dl>
</body>
<script src="js/jquery.js" type="text/javascript"></script>
<!--<script src="dist/tripledes2.min.js"></script>
<script src="dist/cipher-core.min.js"></script>
<script src="dist/core.min.js"></script>
<script src="dist/mode-ecb.min.js"></script>
<script src="dist/md5.min.js"></script>
<script src="dist/Base64.min.js"></script>
<script src="dist/json2.min.js"></script>
<script src="dist/jiami.min.js"></script>
<script src="js/jquery.md5.js"></script>
<script src="dist/baseUtils.min.js"></script>-->
<script type="text/javascript">
function telCheck(){
	var telnum=$('#tel_num').val();
	if(telnum==""||null){
		alert('手机号码不能为空!');
		return false;
		};
	var reg=/(1[3-9]\d{9}$)/;
	if(!reg.test(telnum)){
		alert('请输入正确的手机号码！');
		return false;
	};			
	var race=new Object; 	
	var header=createHeader('','sendResetPwdSmsCode');
	var body=new Object;
	body.tel=telnum;
	//字符串加密处理：				
	race.header=header;		
	race.body=body;			
	var encoded =JSON.stringify(race);
	var str=encryptByDES(encoded,encryptKey);		
	var cont=hashCode(str);
	$.ajax({
		method : "post",				 
		dataType : "jsonp",
		url : portalUrl + 'sms/sendResetPwdSmsCode',
		data:{
			token:'',
			jsonParams:str,
			sign:hashCode(str),
			requestSource:'3'				
		},
		jsonpCallback:"jsonpCallback",
		async: false,				
	}).success(function(data){													
		var res=data.retValue;				
		var res0=trim(res,'g');									
		var result=decryptByDES(res0, encryptKey);
		var ret = jQuery.parseJSON(result);
		var resultCode=ret.body.resultCode;
		var resultDesc=ret.body.resultDesc;
		if(resultCode==1000){
			alert("短信验证码已发送!");
			var smsCode = ret.body.data.smsCode;
			$("#smsCode").val(smsCode);
		}else{
			alert(resultDesc);
		}
	});
};

$('.reg_btn2').click(function(){
	var telnum=$('#tel_num').val();
	if(telnum==""||null){
		alert('手机号码不能为空!');
		return false;
		};
	var reg=/(1[3-9]\d{9}$)/;
	if(!reg.test(telnum)){
		alert('请输入正确的手机号码！');
		return false;
	};
	var smsCode = $("#smsCode").val();
	var yz_code = $("#yz_code").val();
	if(smsCode!=yz_code){
		alert("验证码不正确!");
		return;
	}
	var passwd=$('#passwd').val();		
	if(passwd==""|null){
		alert("密码不能为空!");
		return;
	}			
	//获取验证码
	var race=new Object; 	
	var header=createHeader('','resetPwd');
	var body=new Object;
	var body=new Object;			
	body.tel=telnum;
	body.smsCode=smsCode;
	body.pwd=$.md5(passwd)
	//字符串加密处理：				
	race.header=header;		
	race.body=body;			
	var encoded =JSON.stringify(race);
	var str=encryptByDES(encoded,encryptKey);		
	var cont=hashCode(str);
	$.ajax({
		method : "post",				 
		dataType : "jsonp",
		url : portalUrl + 'user/resetPwd',
		data:{
			token:'',
			jsonParams:str,
			sign:hashCode(str),
			requestSource:'3'				
		},
		jsonpCallback:"jsonpCallback",
		async: false,				
	}).success(function(data){													
		var res=data.retValue;				
		var res0=trim(res,'g');									
		var result=decryptByDES(res0, encryptKey);
		var ret = jQuery.parseJSON(result);
		var resultCode=ret.body.resultCode;
		var resultDesc=ret.body.resultDesc;
		if(resultCode==1000){
			alert("密码已重新设置!");
			window.location.href='logo.html';
		}else{
			alert(resultDesc);
		}
	});
});

</script>
</html>
