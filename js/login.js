// JavaScript Document//上一个登陆页面var url_page = sessionStorage.link_page;//$('#tel_val').val(getUserTel());//自动添加用户上次登录的手机号码//$('#psd_val').val(sessionStorage.user_psd)//自动添加用户上次登录的密码$('#tel_val').val(sessionStorage.user_tel)//自动添加用户上次登录的手机号码//$('#phone_val').val(sessionStorage.user_tel)//自动添加用户上次登录的手机号码//登陆function log_in(link_site) {    //登录校验开始：（从手机号和密码开始）    var tel = $('#tel_val').val();    //var password=$('#psd_val').val();    if (tel == "" || null) {        alert('手机号码不能为空!');        return false;    }    ;    var reg = /(1[3-9]\d{9}$)/;    if (!reg.test(tel)) {        alert('请输入正确的手机号码！');        return false;    } else if ($('input[type="password"]').val() == '') {        alert('请输入密码');        return false;    } else if ($('input[type="password"]').val().length < 6) {        alert('请输入至少6位数密码');        return false;    } else {        localStorage.setItem('user_tel', tel);//为方便用户登录而临时存储其登录手机号码；        //sessionStorage.setItem('user_psd',password);//为方便用户登录而临时存储其登录密码；        sessionStorage.setItem('user_tel', tel);//为方便用户登录而临时存储其登录手机号码；    }    //字符串加密处理：    var obj = new Object;    var body = new Object;    var header = createHeader("", 'systemLogin');    var word = $('input[type="password"]').val();    body.tel = $('input[type="number"]').val();    body.pwd = $.md5(word);    obj.header = header;    obj.body = body;    var encoded = JSON.stringify(obj);    var str = encryptByDES(encoded, encryptKey);    var cont = hashCode(str);    //以下方法赋给登录按钮进行校验：    $.ajax({        type: 'get',        dataType: "jsonp",        url: portalUrl + 'user/systemLogin',        jsonpCallback: "jsonpCallback",        async: false,        data: {            token: "",            jsonParams: str,            sign: hashCode(str),            requestSource: 3        },        success: function (response) {            //回调函数            var res0 = trim(response.retValue, 'g');            var ret = decryptByDES(res0, encryptKey);            var result = jQuery.parseJSON(ret);            var resultCode = result.body.resultCode;            var resultDesc = result.body.resultDesc;            if (resultCode == "1000") {                //封装用户信息                var userinfo = result.body.data;                var userinfo = JSON.stringify(userinfo);                setCookie("userinfo", userinfo, 365);                sessionStorage.setItem('userinfo', userinfo);                localStorage.setItem('userinfo', userinfo);                var loginUserId = userinfo.userId;                if (link_site === undefined) {                    window.location.href = "index.html";                } else {                    window.location.href = link_site;                }            } else {                alert(resultDesc);            }            ;        },    });}//登录方式切换点击$(".logo_psd").on("click", function () {    $(".logo_psd").addClass("bluefont");    $(".logo_code").removeClass("bluefont");    $(".logo_psd_show").show();    $(".logo_code_show").hide();});$(".logo_code").on("click", function () {    $(".logo_code").addClass("bluefont")    $(".logo_psd").removeClass("bluefont")    $(".logo_psd_show").hide();    $(".logo_code_show").show();});//****************************验证码方式登录*******************var stap;//设置获取验证码状态改变$("#phone_val").bind("keyup", function () {    stap = 0;    var telles = $(this).val().length;    //console.log(telles);    if (telles < "11") {        $(".yz_btn").attr("disabled", true).removeClass("code_send");    }    else if (telles == "11") {        if (telCheck()) {            $(".yz_btn").addClass("code_send").attr("disabled", false);            $(".yz_btn").click(function () {                clickcode()            })        } else {            $(".yz_btn").attr("disabled", true);        }    } else if (telles > "11") {        $(".yz_btn").removeClass("code_send").attr("disabled", true);    }    return stap;})/** 2* */// 以下是手机号校验成功后向服务器请求手机验证码//字符串加密处理：// 接口加工function clickcode() {    stap=0;    var body = new Object;    body.tel = $('#phone_val').val();    var obj = new Object;    var header = new Object;    header.requestType = 'sendResetPwdSmsCode';    header.loginUserId = '';    header.macNo = '';    header.appVersionCode = '';    header.appLang = '';    header.appChannel = '';    header.appDeviceType = '';    obj.header = header;// 此方法衔接部分见jiami.js    obj.body = body;    var encoded = JSON.stringify(obj);    var str = encryptByDES(encoded, '1379246805559731246875312468');    var cont = hashCode(str);// （1）开始接口调用请求手机验证码    $.ajax({        type: 'post',        dataType: "jsonp",        url: portalUrl + '/sms/sendLoginSmsCode',        jsonpCallback: "jsonpCallback",        async: false,        data: {            token: "",            jsonParams: str,            sign: hashCode(str),            requestSource: '3'        },        success: function (data) {            var res = data.retValue;            var res0 = trim(res, 'g');            var end = decryptByDES(res0, '1379246805559731246875312468');            //alert(end);            var obj = jQuery.parseJSON(end);            //console.log(obj);            alert(obj.body.resultDesc);            //alert(stap)            waittime();            //$(".code_send").css("background-color", "#999999");        },        error: function (data) {            var str = JSON.stringify(data);        }    });}//登陆校验function tologin(link_site) {    if (stap <= "19") {        telCheck();        if ($('#phone_val').val() == '') {            alert('手机号码不能为空');            return;        } else if ($("#code_val").val() == '') {            alert('请输入验证码');            return;        }        ;        var word = $('#code_val').val();        var obj = new Object;        var header = new Object;        var body = new Object;// 对手机号，验证码，密码进行对象封装        body.tel = $('#phone_val').val();        body.smsCode = $('#code_val').val();        //body.inviteCode = $('#inviteCode').val();        //body.pwd = $.md5(word);        obj.header = header;// 此方法衔接部分见jiami.js        obj.body = body;        var encoded = JSON.stringify(obj);// 加密对象序列化        var str = encryptByDES(encoded, encryptKey);// 加密        var cont = hashCode(str);// 签字        // （2）开始接口调用进行本地注册        $.ajax({            type: 'post',            dataType: "jsonp",            url: portalUrl + '/user/smsCodeLogin',            jsonpCallback: "jsonpCallback",            async: true,            data: {                token: "",                jsonParams: str,                sign: hashCode(str),                requestSource: '3'            },            success: function (data) {                var res = data.retValue;                var res0 = trim(res, 'g');                var ret = decryptByDES(res0, encryptKey);                var result = jQuery.parseJSON(ret);                //console.log(result);                var resultCode = result.body.resultCode;                var resultDesc = result.body.resultDesc;                if (resultCode == "1000") {                    //封装用户信息                    var userinfo = result.body.data;                    var userinfo = JSON.stringify(userinfo);                    //setCookie("userinfo", userinfo, 365);                    sessionStorage.setItem('userinfo', userinfo);                    localStorage.setItem('userinfo', userinfo);                    var loginUserId = userinfo.userId;                    if (link_site === undefined) {                        window.location.href = "index.html";                    } else {                        window.location.href = link_site;                    }                } else {                    alert(resultDesc);                }                ;            },            error: function (data) {                alert(obj.body.resultDesc);            }        });        stap++;        //console.log(stap);    } else {        countdown = 0;        $(".yz_btn").text("发送验证码").attr("disabled", false);        $(".yz_btn").css("background-color", "#00a0e9");        $(".reg_btn").attr("disabled", false);        alert("验证码已失效，请重新获取")        return false;    }}//倒计时函数var countdown = 60;function waittime() {    if (countdown == 0) {        $(".yz_btn").text("发送验证码").attr("disabled", false);        $(".yz_btn").css("background-color", "#00a0e9");        countdown = 60;    } else {        $(".code_send").css("background-color", "#999999");        $(".yz_btn").attr("disabled", true);        var value = countdown + "s后重试";        $(".yz_btn").text(value);        countdown--;        setTimeout(function () {            waittime()        }, 1000)    }}//判断手机号function telCheck() {    var tel = $('#phone_val').val();    if (tel == "" || null) {        alert('手机号码不能为空!');        return false;    }    ;    var reg = /(1[3-9]\d{9}$)/;    if (!reg.test(tel)) {        alert('请输入正确的手机号码！');        return false;    } else {        return true;    }    ;}